/**
 * angular-websql
 * Helps you generate and run websql queries with angular services.
 * Â© MIT License
 */
"use strict";angular.module("angular-websql",[]).factory("$webSql",[function(){return{openDatabase:function(a,b,c,d){try{var e=openDatabase(a,b,c,d);if("undefined"==typeof openDatabase)throw"Browser does not support web sql";return{executeQuery:function(a,b,c){return console.log(a,b),e.transaction(function(d){d.executeSql(a,b,function(a,b){c&&c(b)})}),this},insert:function(a,b,c){var d="INSERT INTO `{tableName}` ({fields}) VALUES({values});",e="",f="",g=[];for(var h in b)e+=Object.keys(b)[Object.keys(b).length-1]==h?"`"+h+"`":"`"+h+"`, ",f+=Object.keys(b)[Object.keys(b).length-1]==h?"?":"?, ",g.push(b[h]);return this.executeQuery(this.replace(d,{"{tableName}":a,"{fields}":e,"{values}":f}),g,c),this},update:function(a,b,c,d){var e="UPDATE `{tableName}` SET {update} WHERE {where}; ",f="",g=[];for(var h in b)f+="`"+h+"`= ?",g.push(b[h]);var i=this.whereClause(c);return this.executeQuery(this.replace(e,{"{tableName}":a,"{update}":f,"{where}":i.w}),g.concat(i.p),d),this},del:function(a,b,c){var d="DELETE FROM `{tableName}` WHERE {where}; ",e=this.whereClause(b);return this.executeQuery(this.replace(d,{"{tableName}":a,"{where}":e.w}),e.p,c),this},select:function(a,b,c){var d="SELECT * FROM `{tableName}` WHERE {where}; ",e=this.whereClause(b);return this.executeQuery(this.replace(d,{"{tableName}":a,"{where}":e.w}),e.p,c),this},selectAll:function(a,b){return this.executeQuery("SELECT * FROM `"+a+"`; ",[],b),this},whereClause:function(a){var c="",d=[];for(var e in a)"undefined"==typeof a[e]||"object"==typeof a[e]||"string"!=typeof a[e]||a[e].match(/NULL/gi)?"undefined"!=typeof a[e]&&"object"!=typeof a[e]&&"number"==typeof a[e]?d.push(a[e]):"undefined"==typeof a[e].value||"object"!=typeof a[e]||a[e].value.match(/NULL/gi)||d.push(a[e].value):d.push(a[e]),c+="object"==typeof a[e]?"undefined"==typeof a[e].union?"string"==typeof a[e].value&&a[e].value.match(/NULL/gi)?"`"+e+"` "+a[e].value:"`"+e+"` "+a[e].operator+" ? ":"string"==typeof a[e].value&&a[e].value.match(/NULL/gi)?"`"+e+"` "+a[e].value+" "+a[e].union+" ":"`"+e+"` "+a[e].operator+" ? "+a[e].union+" ":"string"==typeof a[e]&&a[e].match(/NULL/gi)?"`"+e+"` "+a[e]:"`"+e+"`=?";return{w:c,p:d}},replace:function(a,b){for(var d in b)a=a.replace(new RegExp(d,"ig"),b[d]);return a},createTable:function(a,b,c){var d="CREATE TABLE IF NOT EXISTS `{tableName}` ({fields}); ",e=[],f="";for(var g in b){var h="{type} {null}";f+="`"+g+"` ","undefined"==typeof b[g]["null"]&&(b[g]["null"]="NULL");for(var i in b[g])h=h.replace(new RegExp("{"+i+"}","ig"),b[g][i]);f+=h,"undefined"!=typeof b[g]["default"]&&(f+=" DEFAULT "+b[g]["default"]),"undefined"!=typeof b[g].primary&&(f+=" PRIMARY KEY"),"undefined"!=typeof b[g].auto_increment&&(f+=" AUTOINCREMENT"),Object.keys(b)[Object.keys(b).length-1]!=g&&(f+=","),"undefined"!=typeof b[g].primary&&b[g].primary&&e.push(g)}var j={tableName:a,fields:f};for(var k in j)d=d.replace(new RegExp("{"+k+"}","ig"),j[k]);return this.executeQuery(d,[],c),this},dropTable:function(a,b){return this.executeQuery("DROP TABLE IF EXISTS `"+a+"`; ",[],b),this}}}catch(f){console.error(f)}}}}]);